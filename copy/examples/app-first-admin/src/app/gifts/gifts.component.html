<div class="container-fluid pt-3 design-factory-v2">
  <div class="row align-items-end">
    <div class="col flex-grow-0 flex-shrink-0 d-flex align-items-end">
      <p-form-group class="mr-4"><a (click)="setGift(null, null, null, null, null, null, null, null, null)" class="btn btn-sm btn-danger" href="javascript:void(0)" [pOpenModal]="modalEdit">New</a></p-form-group>
      <ngb-pagination (pageChange)="loadPage($event)" [(page)]="page" [(collectionSize)]="totalItems" [pageSize]="itemsPerPage" [maxSize]="3" [rotate]="true" [boundaryLinks]="true" size="sm"></ngb-pagination>
    </div>
    <div class="col flex-grow-1 flex-shrink-0 d-flex justify-content-end align-items-end">
      <p-form-group label="Description:">
        <input pFormControlInput [(ngModel)]="description" (ngModelChange)="loadTotal($event);loadPage($event)" type="text" id="description" name="description">
      </p-form-group>
      <p-form-group label="Country:" class="ml-4">
        <select pFormControlInput [(ngModel)]="countryCode" (ngModelChange)="loadTotal($event);loadPage($event)" id="country" class="w-auto" name="countryCode">
          <option value="" selected>All</option>
          <option *ngFor="let country of countries | keyvalue" value="{{ country.value }}">{{ country.key }}</option>
        </select>
      </p-form-group>
      <p-form-group label="Category:" class="ml-4">
        <select pFormControlInput [(ngModel)]="category" (ngModelChange)="loadTotal($event);loadPage($event)" id="category" class="w-auto" name="category">
          <option value="">All</option>
          <option *ngFor="let category of categories" value="{{ category }}">{{ category }}</option>
        </select>
      </p-form-group>
      <p-form-group label="Active:" class="ml-4">
        <select pFormControlInput [(ngModel)]="active" (ngModelChange)="loadTotal($event);loadPage($event)" id="status" class="w-auto" name="active">
          <option value="">All</option>
          <option value="Y">Active</option>
          <option value="N">Inactive</option>
        </select>
      </p-form-group>
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      <table class="table table-hover">
        <thead class="thead-dark">
          <tr>
            <th class="w-0 text-left" scope="col"></th>
            <th class="w-0 text-center" scope="col"><a class="text-white" (click)="changeOrder('id');loadPage(sort='id')" href="javascript:void(0)"><small *ngIf="sort === 'id'" [ngClass]="{'icon-arrow-down': (order === 'asc'), 'icon-arrow-up': (order !== 'asc')}" class="table-sort-icon position-absolute"></small>ID</a></th>
            <th class="w-100" scope="col"><a class="text-white" (click)="changeOrder('description');loadPage(sort='description')" href="javascript:void(0)"><small *ngIf="sort === 'description'" [ngClass]="{'icon-arrow-down': (order === 'asc'), 'icon-arrow-up': (order !== 'asc')}" class="table-sort-icon position-absolute"></small>Description</a></th>
            <th class="w-0 text-nowrap" scope="col"><a class="text-white" (click)="changeOrder('category');loadPage(sort='category')" href="javascript:void(0)"><small *ngIf="sort === 'category'" [ngClass]="{'icon-arrow-down': (order === 'asc'), 'icon-arrow-up': (order !== 'asc')}" class="table-sort-icon position-absolute"></small>Category</a></th>
            <th class="w-0 text-center" scope="col"><a class="text-white" (click)="changeOrder('countryCode');loadPage(sort='countryCode')" href="javascript:void(0)"><small *ngIf="sort === 'countryCode'" [ngClass]="{'icon-arrow-down': (order === 'asc'), 'icon-arrow-up': (order !== 'asc')}" class="table-sort-icon position-absolute"></small>Country</a></th>
            <th class="w-0 text-center" scope="col"><a class="text-white" (click)="changeOrder('points');loadPage(sort='points')" href="javascript:void(0)"><small *ngIf="sort === 'points'" [ngClass]="{'icon-arrow-down': (order === 'asc'), 'icon-arrow-up': (order !== 'asc')}" class="table-sort-icon position-absolute"></small>Points</a></th>
            <th class="w-0 text-center" scope="col"><a class="text-white" (click)="changeOrder('quantity');loadPage(sort='quantity')" href="javascript:void(0)"><small *ngIf="sort === 'quantity'" [ngClass]="{'icon-arrow-down': (order === 'asc'), 'icon-arrow-up': (order !== 'asc')}" class="table-sort-icon position-absolute"></small>Quantity</a></th>
            <th class="w-0 text-center" scope="col"><a class="text-white" (click)="changeOrder('active');loadPage(sort='active')" href="javascript:void(0)"><small *ngIf="sort === 'active'" [ngClass]="{'icon-arrow-down': (order === 'asc'), 'icon-arrow-up': (order !== 'asc')}" class="table-sort-icon position-absolute"></small>Active</a></th>
            <th class="w-0 text-center" scope="col"><a class="text-white" (click)="changeOrder('prio');loadPage(sort='prio')" href="javascript:void(0)"><small *ngIf="sort === 'prio'" [ngClass]="{'icon-arrow-down': (order === 'asc'), 'icon-arrow-up': (order !== 'asc')}" class="table-sort-icon position-absolute"></small>Priority</a></th>
            <th class="w-0 text-right" scope="col"></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let gift of gifts" class="col">
            <td class="text-left"><a (click)="setGift(gift.id, gift.description, gift.category, gift.data, gift.countryCode, gift.points, gift.quantity, gift.active, gift.prio)" class="icon-pencil" href="javascript:void(0)" [pOpenModal]="modalEdit"></a></td>
            <td class="text-center">{{ gift.id }}</td>
            <td>{{ gift.description }}</td>
            <td class="text-nowrap">{{ gift.category }}</td>
            <td class="text-center">{{ gift.countryCode }}</td>
            <td class="text-center">{{ gift.points }}</td>
            <td class="text-center">{{ gift.quantity }}</td>
            <td class="text-center"><span [ngClass]="{ 'icon-check text-success': (gift.active === 'Y'), 'icon-disabled text-danger': (gift.active === 'N') }"></span></td>
            <td class="text-center">{{ gift.prio }}</td>
            <td class="text-right"><a (click)="setGift(gift.id, gift.description, gift.category, gift.data, gift.countryCode, gift.points, gift.quantity, gift.active, gift.prio)" class="icon-photo" href="javascript:void(0)" [pOpenModal]="modalImage"></a><!-- [pOpenModal]="modalCmp" {{ gift.id + '.jpg' }}--></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="row align-items-end">
    <div class="col-6 d-flex align-items-end">
      <p-form-group class="mr-4"><a (click)="setGift(null, null, null, null, null, null, null, null, null)" class="btn btn-sm btn-danger" href="javascript:void(0)" [pOpenModal]="modalEdit">New</a></p-form-group>
      <ngb-pagination (pageChange)="loadPage($event)" [(page)]="page" [collectionSize]="totalItems" [pageSize]="itemsPerPage" [maxSize]="3" [rotate]="true" [boundaryLinks]="true" size="sm"></ngb-pagination>
    </div>
  </div>
</div>
<ng-template #modalEdit let-c="close" let-d="dismiss">
  <p-modal (dismiss)="d($event)" title="EDIT GIFT" [dismissible]="true">
    <form [formGroup]="giftForm" (ngSubmit)="onSubmit()">
      <p-form-group>
        <div *ngIf="currentImage" class="text-center"><div class="image-loader d-inline-block"><input pFormControlInput type="file" title="Change Image"><img src="{{ currentImage }}" onError="this.src='assets/svg/gift-default.svg'" alt=""></div></div>
        <input *ngIf="!currentImage" pFormControlInput type="file">
      </p-form-group>
      <p-form-group label="Name:">
        <input pFormControlInput type="text" id="modalName" formControlName="modalName" pattern=".*" [ngClass]="{ 'is-valid': !submitted || !f.modalName.errors, 'is-invalid': submitted && f.modalName.errors }" [value]="currentDescription">
        <div class="invalid-feedback" *ngIf="submitted && f.modalName.errors"><div *ngIf="f.modalName.errors.required">Please provide a valid name.</div></div>
      </p-form-group>
      <p-form-group label="Category:">
        <select pFormControlInput id="modalCategory">
          <option value="" hidden disabled selected></option>
          <option *ngFor="let category of categories" value="{{ category }}" [selected]="(currentCategory === category) ? 'selected' : null">{{ category }}</option>
        </select>
      </p-form-group>
      <p-form-group label="Country:">
        <select pFormControlInput id="modalCountry">
          <option value="" hidden disabled selected></option>
          <option *ngFor="let country of countries | keyvalue" value="{{ country.value }}" [selected]="(currentCountry === country.value) ? 'selected' : null">{{ country.key }}</option>
        </select>
      </p-form-group>
      <p-form-group label="NMC/Region:">
        <select pFormControlInput id="modalRegion">
          <option value="0">All</option>
          <option *ngFor="let region of regions | keyvalue" value="{{ region.value }}" [selected]="(currentRegion === region.value) ? 'selected' : null">{{ region.key }}</option>
        </select>
      </p-form-group>
      <p-form-group class="form-group">
        <label for="modalDescription">Description:</label>
        <textarea id="modalDescription" pFormControlInput class="form-control">{{ currentText }}</textarea>
      </p-form-group>
      <p-form-group label="Points:">
        <input pFormControlInput type="number" id="modalPoints" [value]="currentPoints">
      </p-form-group>
      <p-form-group label="Quantity:">
        <input pFormControlInput type="number" id="modalQuantity" [value]="currentQuantity">
      </p-form-group>
      <p-form-group label="Additional Link:">
        <input pFormControlInput type="text" id="modalLink" [value]="currentLink">
      </p-form-group>
      <p-form-group label="Priority:">
        <input pFormControlInput type="number" id="modalPriority" [value]="currentPriority">
      </p-form-group>
      <p-form-group label="External Gift Code:">
        <input pFormControlInput type="text" id="modalCode" [value]="currentCode">
      </p-form-group>
      <p-form-group label="Active">
        <input pFormControlInput type="checkbox" id="modalActive" [checked]="(currentStatus === 'Y') ? 'checked' : null">
      </p-form-group>
      <hr>
      <div class="d-flex justify-content-between">
        <p-form-group class="m-0"><button p-modal-button class="btn btn-sm btn-primary" [disabled]="loading">Apply</button></p-form-group>
        <p-form-group class="m-0"><button p-modal-button class="btn btn-sm btn-outline-primary" [disabled]="loading" (click)="c('close')">Cancel</button></p-form-group>
        <p-form-group class="m-0"><button p-modal-button class="btn btn-sm btn-primary" (click)="c('save')" [disabled]="loading">Copy</button></p-form-group>
      </div>
    </form>
  </p-modal>
</ng-template>
<ng-template #modalImage let-c="close" let-d="dismiss">
  <p-modal (dismiss)="d($event)" title="Image" [dismissible]="true">
    <img class="w-100"  src="{{ currentImage }}" onError="this.src='assets/svg/gift-default.svg'" alt="">
  </p-modal>
</ng-template>
